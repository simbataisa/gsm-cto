direction: down

# Customer Applications
customer_apps: "Customer Applications" {
  B2C: "B2C Mobile Apps/Web"
  B2B: "B2B Portal"
}

# Core Services
core: "Core Services" {
  API: "API Gateway"
  Auth: "Auth/Identity Service"
  Payment: "Payment Processing"
  Vehicle: "Vehicle Management"
  Order: "Order Management"
  Rental: "Rental Service"
  Analytics: "Analytics Engine"
}

# Observability & SRE
observability: "Observability & SRE" {
  Monitor: "Monitoring Dashboard"
  
  obs_stack: "Observability Stack" {
    Metrics: "Metrics Collection"
    Logs: "Log Aggregation"
    Traces: "Distributed Tracing"
    APM: "Application Performance"
  }
  
  sre: "SRE Tools" {
    Alert: "Alert Management"
    Incident: "Incident Management"
    OnCall: "On-Call Management"
    RunBooks: "Runbooks & Playbooks"
  }
  
  health: "Platform Health" {
    SLO: "SLO Monitoring"
    Capacity: "Capacity Planning"
    Chaos: "Chaos Engineering"
    LoadTest: "Load Testing"
  }
}

# Governance & Compliance
governance: "Governance & Compliance" {
  GRC: "GRC Core Service"
  
  risk: "Risk Management" {
    OpRisk: "Operational Risk"
    MarketRisk: "Market Risk"
    CreditRisk: "Credit Risk"
    FraudRisk: "Fraud Detection"
  }
  
  compliance: "Compliance" {
    RegReport: "Regulatory Reporting"
    KYC_AML: "KYC/AML Service"
    DataPrivacy: "Data Privacy/PDPA"
    RegWatch: "Regulatory Watch"
  }
  
  audit: "Audit & Control" {
    AuditLog: "Audit Logging"
    CompControl: "Compliance Controls"
    AccessCtrl: "Access Control"
  }
  
  Policy: "Policy Management"
}

# Lending Services
lending: "Lending Services" {
  LendCore: "Lending Core Service"
  
  b2c: "B2C Lending" {
    Install: "Installment Service"
    BNPL: "BNPL Service"
    ConsScore: "Consumer Scoring"
  }
  
  b2b: "B2B Lending" {
    MerchLend: "Merchant Lending"
    BizScore: "Business Scoring"
    CollMgmt: "Collateral Management"
  }
  
  LendRisk: "Lending Risk"
  Collection: "Collection Service"
}

# Rewards & Loyalty
rewards: "Rewards & Loyalty" {
  RewardCore: "Rewards Core Service"
  
  reward_types: "Reward Types" {
    Points: "Points Engine"
    Coupon: "Coupon Management"
    Voucher: "Voucher System"
  }
  
  Tiers: "Tier Management"
  Benefits: "Benefits Engine"
  VinLoyalty: "VinGroup Benefits"
  Campaign: "Campaign Management"
  RuleEngine: "Rules Engine"
}

# Integration Layer
integration: "Integration Layer" {
  IntHub: "Integration Hub"
  EventBus: "Event Bus"
}

# External Systems
external: "External Systems" {
  VinGroup: "VinGroup Services"
  VinID: "VinID System"
  Banks: "Banking Partners"
  KYCPartners: "KYC Partners"
  Partners: "Supply Chain/Vendors"
  CreditBureau: "Credit Bureaus"
  Regulators: "Regulatory Bodies"
}

# Data Platform
data: "Data Platform" {
  DataLake: "Data Lake"
  DataWarehouse: "Data Warehouse"
  ML: "ML Pipeline"
  DataGov: "Data Governance"
}

# Connections

# Customer Apps to API
customer_apps.B2C -> core.API: "API Access"
customer_apps.B2B -> core.API: "API Access"

# API to Core Services
core.API -> core.Auth: "Auth"
core.API -> core.Payment: "Payment"
core.API -> core.Vehicle: "Vehicle"
core.API -> core.Order: "Order"
core.API -> core.Rental: "Rental"
core.API -> core.Analytics: "Analytics"
core.API -> lending.LendCore: "Lending"
core.API -> rewards.RewardCore: "Rewards"
core.API -> governance.GRC: "GRC"

# Observability Connections
core.API -> observability.obs_stack.Metrics: "Metrics Collection"
core.API -> observability.obs_stack.Logs: "Log Collection"
core.API -> observability.obs_stack.Traces: "Trace Collection"
core.API -> observability.obs_stack.APM: "Performance Metrics"

core.Auth -> observability.obs_stack.Metrics: "Metrics Collection"
core.Auth -> observability.obs_stack.Logs: "Log Collection"
core.Auth -> observability.obs_stack.Traces: "Trace Collection"
core.Auth -> observability.obs_stack.APM: "Performance Metrics"

# Observability Flow
observability.obs_stack.Metrics -> observability.Monitor: "Monitoring"
observability.obs_stack.Logs -> observability.Monitor: "Monitoring"
observability.obs_stack.Traces -> observability.Monitor: "Monitoring"
observability.obs_stack.APM -> observability.Monitor: "Monitoring"

observability.Monitor -> observability.sre.Alert: "Alerts"
observability.sre.Alert -> observability.sre.Incident: "Create Incident"
observability.sre.Incident -> observability.sre.OnCall: "Notify"
observability.sre.OnCall -> observability.sre.RunBooks: "Follow"

# Platform Health
observability.health.SLO -> observability.sre.Alert: "SLO Breach"
observability.health.Capacity -> observability.sre.Alert: "Capacity Alert"
observability.health.Chaos -> observability.health.LoadTest: "Test"
observability.health.LoadTest -> observability.health.Capacity: "Update"

# Lending Service Connections
lending.LendCore -> lending.b2c.Install: "Installment"
lending.LendCore -> lending.b2c.BNPL: "BNPL"
lending.LendCore -> lending.b2b.MerchLend: "Merchant"
lending.b2c.Install -> lending.b2c.ConsScore: "Score"
lending.b2c.BNPL -> lending.b2c.ConsScore: "Score"
lending.b2b.MerchLend -> lending.b2b.BizScore: "Score"
lending.b2b.MerchLend -> lending.b2b.CollMgmt: "Collateral"
lending.b2c.ConsScore -> lending.LendRisk: "Risk Assessment"
lending.b2b.BizScore -> lending.LendRisk: "Risk Assessment"
lending.LendRisk -> lending.Collection: "Collection"

# Rewards Service Connections
rewards.RewardCore -> rewards.reward_types.Points: "Points"
rewards.RewardCore -> rewards.reward_types.Coupon: "Coupons"
rewards.RewardCore -> rewards.reward_types.Voucher: "Vouchers"
rewards.RewardCore -> rewards.Tiers: "Tiers"
rewards.RewardCore -> rewards.Benefits: "Benefits"
rewards.RewardCore -> rewards.VinLoyalty: "VinGroup"
rewards.Campaign -> rewards.RuleEngine: "Rules"
rewards.RuleEngine -> rewards.reward_types.Points: "Apply"
rewards.RuleEngine -> rewards.reward_types.Coupon: "Apply"
rewards.RuleEngine -> rewards.reward_types.Voucher: "Apply"
rewards.RuleEngine -> rewards.Benefits: "Apply"

# GRC Connections
governance.GRC -> governance.risk.OpRisk: "Operational"
governance.GRC -> governance.risk.MarketRisk: "Market"
governance.GRC -> governance.risk.CreditRisk: "Credit"
governance.GRC -> governance.risk.FraudRisk: "Fraud"
governance.GRC -> governance.compliance.RegReport: "Reporting"
governance.GRC -> governance.compliance.KYC_AML: "KYC/AML"
governance.GRC -> governance.compliance.DataPrivacy: "Privacy"
governance.GRC -> governance.compliance.RegWatch: "Regulatory"
governance.GRC -> governance.audit.AuditLog: "Audit"
governance.GRC -> governance.audit.CompControl: "Control"
governance.GRC -> governance.audit.AccessCtrl: "Access"
governance.GRC -> governance.Policy: "Policy"

# Integration Layer Connections
core.Vehicle -> integration.IntHub: "Integration"
core.Payment -> integration.IntHub: "Integration"
core.Order -> integration.IntHub: "Integration"
core.Rental -> integration.IntHub: "Integration"
lending.LendCore -> integration.IntHub: "Integration"
rewards.RewardCore -> integration.IntHub: "Integration"
integration.IntHub -> integration.EventBus: "Events"

# External Systems Connections
integration.EventBus -> external.VinGroup: "VinGroup"
integration.EventBus -> external.VinID: "VinID"
integration.EventBus -> external.Banks: "Banking"
integration.EventBus -> external.KYCPartners: "KYC"
integration.EventBus -> external.Partners: "Partners"
integration.EventBus -> external.CreditBureau: "Credit"
integration.EventBus -> external.Regulators: "Regulatory"

# Data Platform Connections
integration.EventBus -> data.DataLake: "Data Ingestion"
data.DataLake -> data.DataWarehouse: "ETL"
data.DataWarehouse -> data.ML: "ML Training"
data.DataGov -> data.DataLake: "Governance"
data.DataGov -> data.DataWarehouse: "Governance"
data.ML -> core.Analytics: "Analytics"
data.ML -> lending.b2c.ConsScore: "Scoring"
data.ML -> lending.b2b.BizScore: "Scoring"
data.ML -> rewards.Campaign: "Campaign"

# Compliance Connections
governance.audit.AuditLog -> data.DataLake: "Audit Logs"
governance.audit.CompControl -> governance.compliance.RegReport: "Controls"
governance.audit.AccessCtrl -> core.Auth: "Access Control"

# VinGroup Special Connections
rewards.VinLoyalty -> external.VinID: "Benefits"
governance.compliance.KYC_AML -> external.KYCPartners: "KYC"
governance.compliance.RegReport -> external.Regulators: "Reporting"